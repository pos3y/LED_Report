<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Command Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #111827; color: #fff; } /* Dark Mode Theme */
        .brand-card:hover { transform: translateY(-5px); border-color: #10b981; }
        .search-box:focus-within { border-color: #10b981; box-shadow: 0 0 15px rgba(16, 185, 129, 0.3); }
    </style>
</head>
<body>

    <header class="bg-gray-900 border-b border-gray-800 sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-emerald-600 rounded flex items-center justify-center font-bold text-white text-xl">
                    <i class="fa-solid fa-network-wired"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold tracking-wider text-white">COMMAND CENTER</h1>
                    <p class="text-xs text-gray-400">Media Management System</p>
                </div>
            </div>
            
            <div class="text-right">
                <div class="text-xs text-gray-500">Total Brands</div>
                <div class="text-2xl font-bold text-emerald-500" id="total-count">0</div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-6 py-10">

        <div class="max-w-2xl mx-auto mb-10">
            <div class="search-box flex items-center bg-gray-800 border-2 border-gray-700 rounded-xl px-4 py-3 transition-all duration-300">
                <i class="fa-solid fa-search text-gray-400 text-lg mr-3"></i>
                <input type="text" id="searchInput" placeholder="Search Brand Name..." class="bg-transparent border-none outline-none text-white w-full text-lg placeholder-gray-500" onkeyup="filterBrands()">
            </div>
        </div>

        <div id="loading" class="text-center py-20">
            <i class="fa-solid fa-circle-notch fa-spin text-4xl text-emerald-600 mb-4"></i>
            <p class="text-gray-400">Syncing with Google Sheets...</p>
        </div>

        <div id="brand-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 hidden">
            </div>

    </main>

    <footer class="text-center py-8 text-gray-600 text-xs">
        Authorized Personnel Only
    </footer>

    <script>
        // ==========================================
        //  ใส่ Link CSV เดียวกับหน้า report ครับ
        // ==========================================
        const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRPt5_VqUQSurUF8zod1Ns67QBSMvPhFwpuwvniE8wzX3dDOrXyxClrDywMwMnkaJ-Ite1M3DlLeTZt/pub?gid=0&single=true&output=csv"; 
        const REPORT_PAGE_URL = "index.html"; // ชื่อไฟล์หน้า report ของคุณ
        // ==========================================

        let allBrands = [];

        window.onload = function() {
            fetchData();
        };

        function fetchData() {
            Papa.parse(SHEET_CSV_URL, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    processData(results.data);
                },
                error: function(err) {
                    alert("Connection Failed");
                }
            });
        }

        function processData(rows) {
            // 1. ดึงรายชื่อ Brand ทั้งหมด แล้วทำให้ไม่ซ้ำกัน (Unique)
            const uniqueBrands = {};
            
            rows.forEach(row => {
                if(!row.Brand_ID) return;
                
                const id = row.Brand_ID.trim();
                const name = id.toUpperCase(); // หรือจะใช้ row.Brand_Name ถ้ามีคอลัมน์นั้น
                const month = row.Month;

                if(!uniqueBrands[id]) {
                    uniqueBrands[id] = {
                        id: id,
                        name: name,
                        lastMonth: month,
                        slotCount: 0
                    };
                }
                uniqueBrands[id].slotCount++;
            });

            // แปลง Object เป็น Array เพื่อเอาไป Loop
            allBrands = Object.values(uniqueBrands);

            // เรียงตามตัวอักษร
            allBrands.sort((a, b) => a.name.localeCompare(b.name));

            renderGrid(allBrands);
        }

        function renderGrid(brands) {
            const grid = document.getElementById('brand-grid');
            document.getElementById('loading').classList.add('hidden');
            grid.classList.remove('hidden');
            
            document.getElementById('total-count').innerText = brands.length;
            grid.innerHTML = '';

            brands.forEach(brand => {
                const card = document.createElement('a');
                // ลิงก์ไปยังหน้า Report พร้อมแนบ ?brand=...
                card.href = `${REPORT_PAGE_URL}?brand=${brand.id}`; 
                card.target = "_blank"; // เปิดแท็บใหม่
                card.className = `brand-card block bg-gray-800 border border-gray-700 rounded-xl p-6 transition-all duration-300 group relative overflow-hidden`;
                
                card.innerHTML = `
                    <div class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition">
                        <i class="fa-solid fa-chart-line text-6xl text-white"></i>
                    </div>
                    <div class="relative z-10">
                        <div class="flex items-center gap-3 mb-4">
                            <div class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center text-emerald-400 font-bold border border-gray-600">
                                ${brand.name.charAt(0)}
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-white group-hover:text-emerald-400 transition">${brand.name}</h3>
                                <p class="text-xs text-gray-400">ID: ${brand.id}</p>
                            </div>
                        </div>
                        
                        <div class="border-t border-gray-700 pt-3 mt-2 flex justify-between items-center text-sm">
                            <span class="text-gray-500">Active Records</span>
                            <span class="bg-gray-900 text-white px-2 py-1 rounded text-xs font-mono">${brand.slotCount} Rows</span>
                        </div>
                        
                        <div class="mt-4 flex items-center text-emerald-500 text-sm font-semibold opacity-0 group-hover:opacity-100 transform translate-y-2 group-hover:translate-y-0 transition">
                            View Report <i class="fa-solid fa-arrow-right ml-2"></i>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function filterBrands() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allBrands.filter(b => b.name.toLowerCase().includes(query) || b.id.toLowerCase().includes(query));
            renderGrid(filtered);
        }
    </script>
</body>
</html>